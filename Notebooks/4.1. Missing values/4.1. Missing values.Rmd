---
title: "Missing values"
output: html_notebook
---

Ucitavanje potrebnih biblioteka:

```{r}
install.packages('FSA')

library(tidyverse)
library(FSA)
```

Spojicemo train i test skup:
```{r}
test$Premium.Amount <- NA
data <- rbind(train, test)

summary(data)
```

## Kategorijski atributi

Broj nedostajucih vrednosti u skupu podataka:
```{r}
cat.data <- sapply(data, is.factor)
colSums(is.na(data[, cat.data]))
```

Prikaz procentualnog odnosa nedostajucih podataka: 

```{r}
colSums(is.na(data[, cat.data])) / nrow(data) * 100
```

Tehnike imputacije:
- Nedostajuce vrednosti u varijablama Marital.Status, Insurance.Duration i Customer.Feedback ce biti popunjene sa najvise prisutnom kategorijom u varijabli.
- Nedostajuce vrednosti u varijablama Occupation i Previous.Claims ce biti popunjene sa novom kategorijom UNKNOWN. Procenat nedostajucih vrednosti u ovim varijablama je veliki i imputacija mode tehnikom bi drasticno uticala na distibuciju podataka. Dodavanjem nove kategorije cemo obezbediti da se distribucija podataka ne promeni.

## Imputacija MODE tehnikom

```{r}
cols <- c("Marital.Status", "Insurance.Duration", "Customer.Feedback", "Number.of.Dependents")

for (col in cols) {
  mode.data <- names(which.max(table(data[[col]])))
  
  data[[col]][is.na(data[[col]])] <- mode.data
}
```

## Imputacija UNKNOWN kategorijom

```{r}
data$Previous.Claims <- factor(data$Previous.Claims, ordered = FALSE)

cols <- c("Occupation", "Previous.Claims")

for (col in cols) {
  levels(data[[col]]) <- c(levels(data[[col]]), "UNKNOWN")
  
  data[[col]][is.na(data[[col]])] <- "UNKNOWN"
}
```

## Provera nedostajucih vrednosti

Prikaz procentualnog odnosa nedostajucih podataka: 

```{r}
colSums(is.na(data[, cat.data])) / nrow(data) * 100
```

## Numericki atributi

Broj nedostajucih vrednosti u skupu podataka:
```{r}
num.data <- sapply(data, is.numeric)
colSums(is.na(data[, num.data]))
```

Prikaz procentualnog odnosa nedostajucih podataka: 

```{r}
colSums(is.na(data[, num.data])) / nrow(data) * 100
```

Premium.Amount ima 40% nedostajucih vrednosti, medjutim ovo je ocekivano, jer se u skupu nalaze i opservacije iz test skupa koje nemaju definisane vrednosti za ciljnu promenljivu. Ostale varijable ne sadrze vise od 20% nedostajucih vrednosti. Samim tim, mozemo da izvrsimo imputaciju nedostajucih vrednosti srednjom vrednoscu ili medijanom.
Kako sve numericke varijable nemaju normalnu raspodelu, koristicemo median imputaciju:

```{r}
median.age <- median(data$Age, na.rm = TRUE)
median.credit.score <- median(data$Credit.Score, na.rm = TRUE)
median.vehicle.age <- median(data$Vehicle.Age, na.rm = TRUE)
median.health.score <- median(data$Health.Score, na.rm = TRUE)
```

## Imputacija Age varijable

```{r}
data$Age <- ifelse(
  is.na(data$Age),
  median.age,
  data$Age
)
```

## Imputacija Annual.Income varijable

Racunanje godisnjih primanja po broju prethodno podnetih zahteva za nadoknadu novca. U prethodnoj sekciji je dokazana zavisnost ove dve varijable: 

```{r}
for (pc in unique(data$Previous.Claims)) {

  idx <- data$Previous.Claims == pc & is.na(data$Annual.Income)

  group.median <- median(
    data$Annual.Income[data$Previous.Claims == pc],
    na.rm = TRUE
  )

  data$Annual.Income[idx] <- group.median
}
```

## Imputacija Credit.Score varijable

```{r}
data$Credit.Score <- ifelse(
  is.na(data$Credit.Score),
  median.credit.score,
  data$Credit.Score
)
```

## Imputacija Vehicle.Age varijable

```{r}
data$Vehicle.Age <- ifelse(
  is.na(data$Vehicle.Age),
  median.vehicle.age,
  data$Vehicle.Age
)
```

## Imputacija Health.Score varijable

```{r}
data$Health.Score <- ifelse(
  is.na(data$Health.Score),
  median.health.score,
  data$Health.Score
)
```

Provericemo da li je izvrsena imputacija:

```{r}
colSums(is.na(data[, num.data])) / nrow(data) * 100
```